<div class="container-fluid m-0 p-0">
  <div class="card">
   
    
    <div class="card-body">
      <form [formGroup]="reportForm" (ngSubmit)="onSubmit()">
        <div class="row mb-4">
          <div class="col-md-4 mb-3">
            <label for="patientName" class="form-label fw-bold">
              Patient Name <span class="text-danger" *ngIf="isFieldRequired('patientName')">*</span>
            </label>
            <input
              type="text"
              id="patientName"
              formControlName="patientName"
              class="form-control form-control-lg"
              placeholder="Enter patient's full name"
              [ngClass]="{'is-invalid': submitted && f['patientName'].errors}"
            >
            <div *ngIf="submitted && f['patientName'].errors" class="invalid-feedback">
              <div *ngIf="f['patientName'].errors['required']">Patient name is required</div>
              <div *ngIf="f['patientName'].errors['minlength']">Name must be at least 3 characters long</div>
              <div *ngIf="f['patientName'].errors['maxlength']">Name cannot exceed 100 characters</div>
            </div>
          </div>
          
          <div class="col-md-4 mb-3">
            <label for="doctorName" class="form-label fw-bold">
              Doctor Name <span class="text-danger" *ngIf="isFieldRequired('doctorName')">*</span>
            </label>
            <input
              type="text"
              id="doctorName"
              formControlName="doctorName"
              class="form-control form-control-lg"
              placeholder="Enter doctor's full name"
              [ngClass]="{'is-invalid': submitted && f['doctorName'].errors}"
            >
            <div *ngIf="submitted && f['doctorName'].errors" class="invalid-feedback">
              <div *ngIf="f['doctorName'].errors['required']">Doctor name is required</div>
              <div *ngIf="f['doctorName'].errors['minlength']">Name must be at least 3 characters long</div>
              <div *ngIf="f['doctorName'].errors['maxlength']">Name cannot exceed 100 characters</div>
            </div>
          </div>
          
          <div class="col-md-4 mb-3">
            <label for="appointmentId" class="form-label fw-bold">
              Appointment ID <span class="text-danger" *ngIf="isFieldRequired('appointmentId')">*</span>
            </label>
            <input
              type="text"
              id="appointmentId"
              formControlName="appointmentId"
              class="form-control form-control-lg"
              placeholder="Enter appointment ID number"
              [ngClass]="{'is-invalid': submitted && f['appointmentId'].errors}"
              [readonly]="isEditMode"
            >
            <div *ngIf="submitted && f['appointmentId'].errors" class="invalid-feedback">
              <div *ngIf="f['appointmentId'].errors['required']">Appointment ID is required</div>
              <div *ngIf="f['appointmentId'].errors['pattern']">Appointment ID must be a number</div>
            </div>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="symptom" class="form-label fw-bold">
            Symptoms <span class="text-danger" *ngIf="isFieldRequired('symptom')">*</span>
          </label>
          <textarea
            id="symptom"
            formControlName="symptom"
            class="form-control"
            rows="3"
            placeholder="Describe patient's symptoms in detail"
            [ngClass]="{'is-invalid': submitted && f['symptom'].errors}"
          ></textarea>
          <div *ngIf="submitted && f['symptom'].errors" class="invalid-feedback">
            <div *ngIf="f['symptom'].errors['required']">Symptoms are required</div>
            <div *ngIf="f['symptom'].errors['minlength']">Provide at least 10 characters for symptoms</div>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="diagnosis" class="form-label fw-bold">
            Diagnosis <span class="text-danger" *ngIf="isFieldRequired('diagnosis')">*</span>
          </label>
          <textarea
            id="diagnosis"
            formControlName="diagnosis"
            class="form-control"
            rows="3"
            placeholder="Enter detailed diagnosis"
            [ngClass]="{'is-invalid': submitted && f['diagnosis'].errors}"
          ></textarea>
          <div *ngIf="submitted && f['diagnosis'].errors" class="invalid-feedback">
            <div *ngIf="f['diagnosis'].errors['required']">Diagnosis is required</div>
            <div *ngIf="f['diagnosis'].errors['minlength']">Provide at least 10 characters for diagnosis</div>
          </div>
        </div>
        
        <div class="mb-4">
          <label for="notes" class="form-label fw-bold">Notes</label>
          <textarea
            id="notes"
            formControlName="notes"
            class="form-control"
            rows="3"
            placeholder="Additional notes, recommendations or follow-up instructions (optional)"
          ></textarea>
        </div>
        
        <div class="mb-4 card shadow-sm border-0 bg-light">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h3 class="card-title mb-0"><i class="bi bi-capsule me-2"></i>Prescriptions</h3>
            </div>
            
            <div formArrayName="prescriptions">
              <div *ngFor="let prescription of prescriptions.controls; let i = index" [formGroupName]="i" class="card mb-3 p-3 border">
                <div class="d-flex justify-content-between mb-2">
                  <h4 class="card-title">Prescription #{{i + 1}}</h4>
                  <button *ngIf="prescriptions.length > 1" type="button" class="btn btn-danger btn-sm" (click)="removePrescription(i)">
                    <i class="bi bi-trash me-1"></i> Remove
                  </button>
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label [for]="'medicationName' + i" class="form-label fw-bold">
                      Medication Name <span class="text-danger" *ngIf="isPrescriptionFieldRequired(i, 'name')">*</span>
                    </label>
                    <input
                      [id]="'medicationName' + i"
                      type="text"
                      formControlName="name"
                      class="form-control"
                      placeholder="Enter medication name"
                      [ngClass]="{'is-invalid': submitted && prescription.get('name')?.errors}"
                    >
                    <div *ngIf="submitted && prescription.get('name')?.errors" class="invalid-feedback">
                      <div *ngIf="prescription.get('name')?.errors?.['required']">Medication name is required</div>
                      <div *ngIf="prescription.get('name')?.errors?.['minlength']">Name must be at least 3 characters</div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label [for]="'dosage' + i" class="form-label fw-bold">
                      Dosage <span class="text-danger" *ngIf="isPrescriptionFieldRequired(i, 'dosage')">*</span>
                    </label>
                    <input
                      [id]="'dosage' + i"
                      type="text"
                      formControlName="dosage"
                      class="form-control"
                      placeholder="E.g., 500mg twice daily"
                      [ngClass]="{'is-invalid': submitted && prescription.get('dosage')?.errors}"
                    >
                    <div *ngIf="submitted && prescription.get('dosage')?.errors" class="invalid-feedback">
                      <div *ngIf="prescription.get('dosage')?.errors?.['required']">Dosage is required</div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label [for]="'duration' + i" class="form-label fw-bold">
                      Duration <span class="text-danger" *ngIf="isPrescriptionFieldRequired(i, 'duration')">*</span>
                    </label>
                    <input
                      [id]="'duration' + i"
                      type="text"
                      formControlName="duration"
                      class="form-control"
                      placeholder="E.g., 7 days, 2 weeks"
                      [ngClass]="{'is-invalid': submitted && prescription.get('duration')?.errors}"
                    >
                    <div *ngIf="submitted && prescription.get('duration')?.errors" class="invalid-feedback">
                      <div *ngIf="prescription.get('duration')?.errors?.['required']">Duration is required</div>
                    </div>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label [for]="'instructions' + i" class="form-label fw-bold">
                      Instructions <span class="text-danger" *ngIf="isPrescriptionFieldRequired(i, 'instructions')">*</span>
                    </label>
                    <textarea
                      [id]="'instructions' + i"
                      formControlName="instructions"
                      class="form-control"
                      rows="2"
                      placeholder="Special instructions for taking this medication"
                      [ngClass]="{'is-invalid': submitted && prescription.get('instructions')?.errors}"
                    ></textarea>
                    <div *ngIf="submitted && prescription.get('instructions')?.errors" class="invalid-feedback">
                      <div *ngIf="prescription.get('instructions')?.errors?.['required']">Instructions are required</div>
                      <div *ngIf="prescription.get('instructions')?.errors?.['minlength']">Provide at least 5 characters</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-end align-items-center mb-3">
                <button type="button" class="btn btn-primary " (click)="addPrescription()">
                  <i class="bi bi-plus-circle me-1"></i> Add Prescription
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="d-flex justify-content-end mt-4">
          <button type="button" class="btn btn-outline-secondary me-2" (click)="cancel()">
            <i class="bi bi-x-circle me-1"></i> Cancel
          </button>
          <button type="button" class="btn btn-outline-warning me-2" (click)="resetForm()">
            <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
          </button>
          <button type="submit" class="btn btn-success btn-lg" [disabled]="loading">
            <i class="bi" [ngClass]="isEditMode ? 'bi-pencil-square' : 'bi-save'"></i> 
            <span *ngIf="!loading">{{ isEditMode ? 'Update Report' : 'Save Report' }}</span>
            <span *ngIf="loading">{{ isEditMode ? 'Updating...' : 'Saving...' }} <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>